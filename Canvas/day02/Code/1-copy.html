<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>绘制折线图</title>
  <style>
    canvas {
      border: 1px solid #ff0000;
    }
  </style>
</head>

<body>
  <canvas width="600" height="400"></canvas>

  <script>
    // 准备数据
    var data = [
      { x: 100, y: 100 },
      { x: 200, y: 120 },
      { x: 300, y: 180 },
      { x: 400, y: 300 },
      { x: 500, y: 140 }
    ]

    // 创建构造函数
    var LineChart = function(){
      this.canvas = document.querySelector('canvas');
      this.context = this.canvas.getContext('2d');

      // 获取画布尺寸
      this.width = this.canvas.width;
      this.height = this.canvas.height;

      // 设置间隔距离
      this.space = 20;
      // 设置箭头尺寸
      this.arrow = 10;
      // 小方块的尺寸
      this.square = 8;

      // 设置原点
      this.zeroX = this.space; 
      this.zeroY = this.height - this.space;
    }

    // 给折线图添加init方法
    LineChart.prototype.init = function(data){
      // 1.画坐标系
      this.drawCoordinate();
      this.drawDots(data);
    }

    // 画坐标系
    LineChart.prototype.drawCoordinate = function(){
      // 1.确定原点


      // 画X轴
      this.context.moveTo(this.zeroX,this.zeroY);
      this.context.lineTo(this.width-this.space,this.zeroY);
      this.context.lineTo(this.width-this.space-this.arrow,this.height-this.space+this.arrow/2);
      this.context.lineTo(this.width-this.space-this.arrow,this.height-this.space-this.arrow/2);
      this.context.lineTo(this.width-this.space,this.zeroY);
      this.context.stroke();
      this.context.fill();


      // 画Y轴
      this.context.moveTo(this.zeroX,this.zeroY);
      this.context.lineTo(this.zeroX,this.space);
      this.context.lineTo(this.space+this.arrow/2,this.space+this.arrow);
      this.context.lineTo(this.space-this.arrow/2,this.space+this.arrow);
      this.context.lineTo(this.zeroX,this.space);
      this.context.stroke();
      this.context.fill();
    }

    // 画小方块(要画小方块 必须知道数据的坐标)
    LineChart.prototype.drawSquare = function(data){
      this.context.beginPath();
      this.context.moveTo(data.x - this.square/2,data.y - this.square/2);
      this.context.rect(data.x - this.square/2,data.y - this.square/2,this.square,this.square);
      this.context.fill();
    }

    // 转换坐标
    LineChart.prototype.transform = function(data){
      var _this = this;

      // 创建一个新的数组用来保存转换后的数据
      var canvasData = [];
      // 遍历原来的老数据
      data.forEach(function(item) {
        canvasData.push({
          x: _this.zeroX + item.x,
          y: _this.zeroY - item.y
        })
      });

      return canvasData;
    }

    // 画多个点
    LineChart.prototype.drawDots = function(data){
      var _this = this;

    LineChart.prototype.drawLine = function(startX,startY,endX,endY){
      this.context.beginPath();
      this.context.moveTo(startX,startY);
      this.context.lineTo(endX,endY);
      this.context.stroke();
    }
      // 转换坐标
      var transformData = this.transform(data);
      
      // 遍历所有数据 准备连线
      transformData.forEach(function(item,i){
        _this.drawSquare(item);

        if(i == 0) {
          _this.drawLine(_this.zeroX,_this.zeroY,item.x,item.y);
        }else {
          _this.drawLine(transformData[i-1].x,transformData[i-1].y,item.x,item.y);
        }
      })
    }
    
    new LineChart().init(data);
    // new LineChart().drawSquare({x:100,y:100})
    // console.log(new LineChart().transform(data));

  </script>
</body>

</html>