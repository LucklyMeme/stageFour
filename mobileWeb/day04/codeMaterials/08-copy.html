<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>轮播图</title>
  <style>
    html,body {
      margin:0;
      padding:0;
      width:100%;
      height:100%;
      overflow: hidden;
      position: relative
    }
    ul {
      list-style: none;
      margin:0;
      padding:0;
      position: relative;
    }
    li {
      float: left;
    }
    img {
      width:100%;
      vertical-align: middle;
    }
  </style>
</head>
<body>
    <div class="view">
      <ul>
        <li><img src="./image/0.png" alt=""></li>
        <li><img src="./image/1.png" alt=""></li>
        <li><img src="./image/2.png" alt=""></li>
        <li><img src="./image/3.png" alt=""></li>
        <li><img src="./image/4.png" alt=""></li>
        <li><img src="./image/5.png" alt=""></li>
        <li><img src="./image/6.png" alt=""></li>
        <li><img src="./image/7.png" alt=""></li>
      </ul>
    </div>
    <script>
      // 功能:轮播图(1.用js布局轮播图)
      // 步骤:
          // 1.获取元素
          var view = document.querySelector('.view');
          var ul = document.querySelector('.view ul');
          // 为了克隆
          var firstLi = document.querySelector('.view li:first-child');
          var lastLi =   document.querySelector('.view li:last-child');
          // 2.声明变量
          var width,// 是view的宽度
              size, //是li的个数
               lis, // 是获取到的li的数组名称
               startX,endX,// 获取的是手指滑动的位置
               index=0,//是轮播图的索引
               timer;//定时器
              //  一个布尔变量 
          var locked = false;
          // 3.初始化页面
          function init(){
            // 把第一个li添加到最后一个li后面
            ul.appendChild(firstLi.cloneNode(true));
            // 把最后一个li添加到第一个li的前面
            ul.insertBefore(lastLi.cloneNode(true),firstLi);
            // 获取li
            lis = document.querySelectorAll('.view li');
            // 把li的长度赋值给size
            size  = lis.length;
            // 设置成轮播图的样式(设置宽度)
            setWidth();
            // 自动轮播
             autoPlay();

            //  为了让用户看到的第一个图是0 因此要做初始化
            index --;
            ul.style.left = width * index +'px';
          }
          // 4.设置宽度
          function setWidth(){
            // 获取view的宽度 为了设置ul和li的宽度
            width = view.clientWidth;
            //  设置ul的宽度
            ul.style.width =  width * size +'px';
            //  设置li的宽度
            for(var i = 0;i<lis.length;i++){
              lis[i].style.width = width +'px';
            }

          }
          // 5.自动轮播
          function autoPlay(){
            timer = setInterval(function(){
              
              index --;
              ul.style.transition = 'all 0.5s';
              ul.style.left = width * index +'px';
            },1500)
          }
          // 6.判断索引(在过渡完成时判断)让轮播不要出现露白
          ul.addEventListener('webkitTransitionEnd',function(){

            locked = false;
            // 左侧
            if(index == 0) {
              index = -8;
            }
            if(index == -9){
              index = -1;
            }

            ul.style.transition = '';
            ul.style.left = width * index +'px';
          })
          // 7.获取startX的值
          ul.addEventListener('touchstart',function(ev){
            clearInterval(timer);
            var touches = ev.targetTouches[0];

            // 获取起始点的x轴坐标
            startX =touches.clientX;
          })
          // 8.获取endX的值并判断水平方向
          ul.addEventListener('touchend',function(ev){
            autoPlay();
            // 如果locked是false 那么这个if语句不会执行 直接到下面控制轮播方向的代码处
            //  如果locked是true 那么if语句会返回 return 那么如果见到return 代码回直接终止
            if(locked){
              return;
            }

            locked = true;
            var touches = ev.changedTouches[0];
            
            // 获取终止点的X轴坐标
            endX =touches.clientX;  
            // 判断方向
            if(endX > startX){
              // 向右
              index ++;
            }else {
              // 向左
              index --;
            }
            ul.style.transition = 'all 0.5s';
            ul.style.left = width * index +'px';
          })
          // 8.添加节流阀
          init();
    </script>
</body>
</html>